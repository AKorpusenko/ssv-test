#!/bin/bash

# Step 1: Start the beacon_proxy and ssv-node services
docker compose up -d --build beacon_proxy ssv-node-1 ssv-node-2 ssv-node-3 ssv-node-4

# Step 2: Run logs_catcher in Mode Slashing
docker compose run --build logs_catcher logs-catcher --mode Slashing

# Step 3: Stop the services
docker compose down

# Step 4. Run share_update for non leader
docker compose run --build share_update share-update --validator-pub-key "8c5801d7a18e27fae47dfdd99c0ac67fbc6a5a56bb1fc52d0309626d805861e04eaaf67948c18ad50c96d63e44328ab0" --db-path "/ssv-node-4-data/db" --operator-private-key "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBdi82RytFUEhOK2NycGZ1Z01aYTZCSk93dnJyN1M0aS9tamttNThzM3dFeGRWcVBSCjZFbXBUa29QQ0tWamlWSTMvUzIvRjdRdm1FNlA1M3N3cEZoOUJMNmdodGlGVm1TMFdBWk56Mkk4MlFPTUd3M3EKSEk4NmJSS2RuUjdmU2ZjYlFtSlFuRDNyK0xVRngyQngxZENVd3BJOW1IOFc0SGtUcTRWSEZNVjlKVHJpY2FhLwpSZ0lqd3RjZ25QUkQ3VTBpeU1zeStyS2RpK2xWcHJqNHFqYmxwRnowTEZxdWthZzhxZ3FWempFVmxURlJrdW5pCmhvNm96TlZhZU1sSnlXRk4rZ1d5YVp5T0xQMjVhNjl2V0hwbTF4bWdyVm5lb2dwR2dzSE0wZm5McklFeVNSQ1AKdjU5UEVwYTZIdGtlODh1ZjkwRFBDa2RaV0xnTXRzdnkwREJDclFJREFRQUJBb0lCQUMrZXN0MWEra3VjVTlBcwpkQlE0blZUTFNQaFZxa1NXMjJjbUs4Y3NPVnpCMUJqTU15RVpQQndGOUdxaGt1bVpjZmVpNUJXK0JGd1RpRS9TCjEwSzhDKzRrVmU1OFA3NG81aTQ3Q2d1WkF4eVVhNmkrTDhYN3BITXZQZGFkdEtaRTJ3Y0JHWnRYSkhNZ2V4bHoKaTJpTC9vbXYrZ1ViNkpHdWxqbGhxanExclErUmVBdjJmVFlOR29KbUtHUFhsaW1pOCtLZDhkWHBkS0NEU3RvMgpOUDcrWGNKeE1jZWpWRG1WNFozcncrZW1vUGdyKzlKM0NaMElXVmlEeGlCNFIvMVVPL2l5NmdYU1dhNmxJdlRvCjJKN1Q5bFAzMG4wT3RGTTdTaUw5TEhuYlBPeFNONXd4SkROenc1eEpaWUNMbDQwdU9lcktUVFZXZzBUU0Q2dGEKZE9Zc2VPRUNnWUVBek1hQWZraUp5d1h0ckhnN2ozRUx3WFZQMVNUM1RERGhSa0d2eUtUVExVWUpidFp2bjQ4MQp3MWppajBJK2tEZjdLb0RnVTRDUnN6N0lCdzRwVEEvVWphMFkrV294ODkxTlVzVFg5YktXOHJWZXMxNDc2TzNHCnZzaVpqT1RVMWhHNmlDdCt4ZXV4S1VKQlVnSUFIaVloK0JZQXJtSEwvam5waDZ5UXQ5ZUFQa1VDZ1lFQThBV0sKVGZWeTY0N1Y2Wmw0SGtpYzA0OTA3dzhGb1B1b0pKbkRPaTBPT1FacWdzbHpmbytpb1pNWFpib2hlWVlrMkRWSgpLdXZ3bXlSYnp3clZSMHRsMUtZMUpCUlBPUnZJZ05OcUd4U1VPOVNHdGp5WDJkeGw5NnFyeXpYRWZBZDlPbDZ5CkRVbUhVazNPU0ptUUFVZUlNQWVja3dCbHJQNkFGUHF6YkRseERVa0NnWUFtVzNodUwwQkFXMWZ0Mm9ldGtzdFUKN1ppS29HWUNTNVduQjE3YUFxWGI4U2FMTUhld042OG1iRnZqNGRDK1N2NHRNLzdSSldBbFp6a291U3BiS1F2egpqZDBEdXpTb0xXZnlmUlRHM1RFUlBaQURvVDh2bm5wLytpdHBET1FoUlNqZm9PWWFSTS9tbnBhRnVnSXpvNGp4Clk0MjFISFNOcG1Oc0dwTHhITmpVMFFLQmdRRGNTZWx1dFlnOHc4SjJmR0V2UWl1VlRBUGhhS01jNWZ1alkvQTMKRTZVTEYyVm9GZVpIVVNMTk1rZjJHSWVpbGtoNG15ZEZHbmlnbXhVY0IvQkpWOXprOTRxc1MydU9tWDVESmtZcgpCbzhwL2x1SkpFR21OVTdzcVJxMURlc0Fmb3NqcUVlNFJEVExpQmQ4c0Z2bm9MUlFpSnZlbXkyMlFYcGlSdG1uCnlXeUY2UUtCZ1FDVHNCemRZOVRuWTZXMkgyTnBtVGg0c1VqV3BIRUFXa01hUnJDMkp1b0p3Mkp3TExjRGFFVEMKaGhia1BmY2pnb2draWxoUmRYaktWM29IVkxsN1d6Rlp4OHRqU29LRDU0eVRtV1JoL2JsWDBOZFFmQjhUcnNoWQpONkhqV2RRLys1NFJkOEdlTHRMVkF5b1B1eTRnalNPUnJReWVKWC9US01CV1hqcVVyL0pyN1E9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo="

# Step 5. Run share_update for leader
docker compose run --build share_update share-update --validator-pub-key "81bde622abeb6fb98be8e6d281944b11867c6ddb23b2af582b2af459a0316f766fdb97e56a6c69f66d85e411361c0b8a" --db-path "/ssv-node-4-data/db" --operator-private-key "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBdi82RytFUEhOK2NycGZ1Z01aYTZCSk93dnJyN1M0aS9tamttNThzM3dFeGRWcVBSCjZFbXBUa29QQ0tWamlWSTMvUzIvRjdRdm1FNlA1M3N3cEZoOUJMNmdodGlGVm1TMFdBWk56Mkk4MlFPTUd3M3EKSEk4NmJSS2RuUjdmU2ZjYlFtSlFuRDNyK0xVRngyQngxZENVd3BJOW1IOFc0SGtUcTRWSEZNVjlKVHJpY2FhLwpSZ0lqd3RjZ25QUkQ3VTBpeU1zeStyS2RpK2xWcHJqNHFqYmxwRnowTEZxdWthZzhxZ3FWempFVmxURlJrdW5pCmhvNm96TlZhZU1sSnlXRk4rZ1d5YVp5T0xQMjVhNjl2V0hwbTF4bWdyVm5lb2dwR2dzSE0wZm5McklFeVNSQ1AKdjU5UEVwYTZIdGtlODh1ZjkwRFBDa2RaV0xnTXRzdnkwREJDclFJREFRQUJBb0lCQUMrZXN0MWEra3VjVTlBcwpkQlE0blZUTFNQaFZxa1NXMjJjbUs4Y3NPVnpCMUJqTU15RVpQQndGOUdxaGt1bVpjZmVpNUJXK0JGd1RpRS9TCjEwSzhDKzRrVmU1OFA3NG81aTQ3Q2d1WkF4eVVhNmkrTDhYN3BITXZQZGFkdEtaRTJ3Y0JHWnRYSkhNZ2V4bHoKaTJpTC9vbXYrZ1ViNkpHdWxqbGhxanExclErUmVBdjJmVFlOR29KbUtHUFhsaW1pOCtLZDhkWHBkS0NEU3RvMgpOUDcrWGNKeE1jZWpWRG1WNFozcncrZW1vUGdyKzlKM0NaMElXVmlEeGlCNFIvMVVPL2l5NmdYU1dhNmxJdlRvCjJKN1Q5bFAzMG4wT3RGTTdTaUw5TEhuYlBPeFNONXd4SkROenc1eEpaWUNMbDQwdU9lcktUVFZXZzBUU0Q2dGEKZE9Zc2VPRUNnWUVBek1hQWZraUp5d1h0ckhnN2ozRUx3WFZQMVNUM1RERGhSa0d2eUtUVExVWUpidFp2bjQ4MQp3MWppajBJK2tEZjdLb0RnVTRDUnN6N0lCdzRwVEEvVWphMFkrV294ODkxTlVzVFg5YktXOHJWZXMxNDc2TzNHCnZzaVpqT1RVMWhHNmlDdCt4ZXV4S1VKQlVnSUFIaVloK0JZQXJtSEwvam5waDZ5UXQ5ZUFQa1VDZ1lFQThBV0sKVGZWeTY0N1Y2Wmw0SGtpYzA0OTA3dzhGb1B1b0pKbkRPaTBPT1FacWdzbHpmbytpb1pNWFpib2hlWVlrMkRWSgpLdXZ3bXlSYnp3clZSMHRsMUtZMUpCUlBPUnZJZ05OcUd4U1VPOVNHdGp5WDJkeGw5NnFyeXpYRWZBZDlPbDZ5CkRVbUhVazNPU0ptUUFVZUlNQWVja3dCbHJQNkFGUHF6YkRseERVa0NnWUFtVzNodUwwQkFXMWZ0Mm9ldGtzdFUKN1ppS29HWUNTNVduQjE3YUFxWGI4U2FMTUhld042OG1iRnZqNGRDK1N2NHRNLzdSSldBbFp6a291U3BiS1F2egpqZDBEdXpTb0xXZnlmUlRHM1RFUlBaQURvVDh2bm5wLytpdHBET1FoUlNqZm9PWWFSTS9tbnBhRnVnSXpvNGp4Clk0MjFISFNOcG1Oc0dwTHhITmpVMFFLQmdRRGNTZWx1dFlnOHc4SjJmR0V2UWl1VlRBUGhhS01jNWZ1alkvQTMKRTZVTEYyVm9GZVpIVVNMTk1rZjJHSWVpbGtoNG15ZEZHbmlnbXhVY0IvQkpWOXprOTRxc1MydU9tWDVESmtZcgpCbzhwL2x1SkpFR21OVTdzcVJxMURlc0Fmb3NqcUVlNFJEVExpQmQ4c0Z2bm9MUlFpSnZlbXkyMlFYcGlSdG1uCnlXeUY2UUtCZ1FDVHNCemRZOVRuWTZXMkgyTnBtVGg0c1VqV3BIRUFXa01hUnJDMkp1b0p3Mkp3TExjRGFFVEMKaGhia1BmY2pnb2draWxoUmRYaktWM29IVkxsN1d6Rlp4OHRqU29LRDU0eVRtV1JoL2JsWDBOZFFmQjhUcnNoWQpONkhqV2RRLys1NFJkOEdlTHRMVkF5b1B1eTRnalNPUnJReWVKWC9US01CV1hqcVVyL0pyN1E9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo="

# Step 6: Start the beacon_proxy and ssv-nodes again
docker compose up -d beacon_proxy ssv-node-1 ssv-node-2 ssv-node-3 ssv-node-4

# Step 7: Run logs_catcher in Mode BlsVerification for non leader
docker compose run --build logs_catcher logs-catcher --mode BlsVerification --leader 1

# Step 8: Run logs_catcher in Mode BlsVerification for leader
docker compose run --build logs_catcher logs-catcher --mode BlsVerification --leader 4
